<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="description" content="Oficiální stránky PHP komunity">
    <meta name="keywords" content="PHP, komunita, programování">
    <meta name="author" content="https://pehapkari.cz">
    <meta name="robots" content="index, follow">

    <meta property="og:image" content="/images/php-square.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href="/assets/bootstrap/bootstrap.min.css?v=0.6" rel="stylesheet" type="text/css">

    <link href="/assets/css/style.css?v=0.6" rel="stylesheet" type="text/css">

    <link href="/favicon.ico" rel="shortcut icon">

    <title>Drop RobotLoader and let Composer Deal with Autoloading</title>
</head>

    <body>
<header>
    <div class="hidden-sm-down">
        <div class="container-fluid">
            <a href="/"><img src="/assets/images/logo-header.svg?ver" alt="" height="50"></a>

            <nav class="navbar top-navigation">
                <a href="/blog/" class="active">
                    <em class="fa fa-newspaper-o fa-fw"></em>
                    Blog
                </a>
                <a href="/vzdelavej-se/">
                    <em class="fa fa-graduation-cap fa-fw"></em>
                    Školení
                </a>
                <a href="/mentori/">
                    <em class="fa fa-handshake-o fa-fw"></em>
                    Mentoři
                </a>

                    

                    <a href="https://github.com/pehapkari/pehapkari.cz/edit/master/source/_posts/2017/2017-03-02-drop-robot-loader-and-let-composer-deal-with-autoloading.md" class="hidden-sm">
                        <em class="fa fa-fw fa-pencil"></em>
                        Edit
                    </a>
            </nav>
        </div>
    </div>

    <div id="mobile-menu" class="row text-center hidden-md-up">
        <div class="container">
            <a href="/" class="col-3 col-sm-3">
                <em class="fa fa-home"></em>
                <br>
                Home
            </a>
            <a href="/blog/" class="col-3 col-sm-3 active">
                <em class="fa fa-book fa-fw"></em>
                <br>
                Blog
            </a>
            <a href="/vzdelavej-se/" class="col-3 col-sm-3">
                <em class="fa fa-graduation-cap fa-fw"></em>
                <br>
                Školení
            </a>
            <a href="/mentori/" class="col-3 col-sm-3">
                <em class="fa fa-handshake-o fa-fw"></em>
                <br>
                Mentoři
            </a>
        </div>
    </div>
</header>

        <div id="article">
            <div class="container">
                <h1 class="h2 text-center">Drop RobotLoader and let Composer Deal with Autoloading</h1>

                <div class="row text-center">
                    <div class="col-md-12">
<div class="metadataLine">

    <p>
        <em class="fa fa-clock-o fa-fw"></em>
        4 min

        |

        by <strong>Tomáš Votruba</strong>

        &ndash;

        <time datetime="2017-03-Thu">
            2. 3. 2017
        </time>

    </p>
</div>
                    </div>
                </div>

                <br>

                <div id="article-content">
                    <p class="perex">Using 2 tools for one thing, in this case 2 packages to autoload classes, are sign of an architecture smell. Many applications I see contain RobotLoader for historical reasons. I will borrow this from psychology: pathological behavioral patterns tear us down in the present, but were useful in past.
<br><br>
The best way to deal with them is acknowledge their purpose and then, let them go and enjoy the gift of present.</p>

                    
<p><em>Martin Zlámal already <a href="https://zlml.cz/psr-4-autoloader-aplikace">wrote about this</a> (Czech) a year ago and I think this needs to be promoted even more.</em></p>
<h2 id="where-is-robotloader-useful"><a class="anchor" href="#where-is-robotloader-useful" aria-hidden="true"><span class="anchor-icon">#</span></a>Where is RobotLoader Useful</h2>
<p><a href="https://doc.nette.org/en/auto-loading#toc-nette-loaders-robotloader">RobotLoader</a> is a Nette Component that is used to autoload classes. Its killer feature is simple: <strong>in whatever file it is and whatever the class name is, I will load it</strong>. You can have 20 classes in 1 file or classes located in various locations, they won't hide.</p>
<h3 id="before-composer-appeared-it-was-the-best"><a class="anchor" href="#before-composer-appeared-it-was-the-best" aria-hidden="true"><span class="anchor-icon">#</span></a>Before Composer appeared, it was The Best</h3>
<p>RobotLoader was a very useful tool in times before Composer, because <strong>there were not so many efficient tools for loading classes</strong>.</p>
<p>Also, when people could not agree upon where to put their classes, how to name them, whether use or don't use namespace and how many classes to put in one file, we can say <strong>this tool saved a lot of argument-hours</strong>.</p>
<p>After many discussions, followed by the first standard, <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a>, people agreed upon <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a>, a more mature replacement of PSR-0.</p>
<h3 id="why-it-s-not-anymore"><a class="anchor" href="#why-it-s-not-anymore" aria-hidden="true"><span class="anchor-icon">#</span></a>Why it's not Anymore</h3>
<p>Have your heard about PSR-4? It is a <em>PHP Standard Recommendation</em> about naming and location of the classes. This says you completely nothing, but in the simplest form it means:</p>
<p><strong>1 class</strong> (or interface/trait) = <strong>1 file</strong></p>
<p><strong>class name</strong> = <strong>file name</strong>.php</p>
<p><strong>namespace\class name</strong> = <strong>directory/file name</strong>.php</p>
<pre><code class="language-bash"># class =&gt; file
MyClass =&gt; MyClass.php
App\MyClass =&gt; App/MyClass.php
App\Presenter\MyClass =&gt; App/Presenter/MyClass.php</code></pre>
<p>I know I can rely on this in 99% of places when <code>composer.json</code> is used.</p>
<p>When I see <code>App\Presenter\MyClass</code> I  it's located in <code>App/Presenter/MyClass.php</code> file.</p>
<p>And this is the place where <strong>RobotLoader</strong> (or any custom ultimate loader) <strong>fails</strong>. I came around many applications where classes are located at random. And I had to use my brain to find them. But I don't want to focus my mental activity on thinking about their location, <strong>I want to develop my application</strong>.</p>
<h2 id="how-to-move-to-composer-in-a-nette-application"><a class="anchor" href="#how-to-move-to-composer-in-a-nette-application" aria-hidden="true"><span class="anchor-icon">#</span></a>How to move to Composer in a Nette application?</h2>
<p>If you prefer reading commits, here is one <a href="https://github.com/TomasVotruba/igloonet-se-skoli/pull/8/commits/10f389738ca1fef559ba9fd9509b36151cdaf400">applying this</a> on Nette sandbox.</p>
<p>And if not, there are 2 levels of how to achieve this.</p>
<h3 id="level-1-change-your-composer"><a class="anchor" href="#level-1-change-your-composer" aria-hidden="true"><span class="anchor-icon">#</span></a>Level 1: Change your Composer</h3>
<p>The first level requires 3 small steps.</p>
<h4 id="1-tune-code-composer-json-code-autoloading"><a class="anchor" href="#1-tune-code-composer-json-code-autoloading" aria-hidden="true"><span class="anchor-icon">#</span></a>1. Tune <code>composer.json</code> Autoloading</h4>
<pre><code class="language-javascript">{
    "require": {
        "..."
    },
    "autoload": {
        "psr-4": {
            "App\\Forms\\": "app/forms",
            "App\\Model\\": "app/model",
            "App\\Presenters\\": "app/presenters",
            "App\\Router\\": "app/router"
        }
    }
}</code></pre>
<p>This means, all classes residing in <code>App\\Forms</code> namespace have to be located in <code>app/forms</code> directory.</p>
<p>One important rule - it works in <strong>case-sensitive</strong> manner.</p>
<p>So this will work:</p>
<pre><code class="language-bash">App\Presenters\HomepagePresenter =&gt; app/presenters/HomepagePresenter.php</code></pre>
<p>But this will not:</p>
<pre><code class="language-bash">App\Presenters\HomepagePresenter =&gt; app/presenters/homepagePresenter.php</code></pre>
<h4 id="2-disable-robotloader"><a class="anchor" href="#2-disable-robotloader" aria-hidden="true"><span class="anchor-icon">#</span></a>2. Disable RobotLoader</h4>
<p>Now you can clean up your <code>app/bootstrap.php</code>:</p>
<pre><code class="language-php">// $configurator-&gt;createRobotLoader()
//      -&gt;addDirectory(__DIR__)
//      -&gt;register();</code></pre>
<p>But RobotLoader is still silently enabled for presenters. We don't want that either now:</p>
<pre><code class="language-yaml"># app/config/config.neon
application:
    scanDirs: false</code></pre>
<h4 id="3-refresh-composer-autoloading"><a class="anchor" href="#3-refresh-composer-autoloading" aria-hidden="true"><span class="anchor-icon">#</span></a>3. Refresh Composer Autoloading</h4>
<p>And tell Composer, to regenerate its autoloader:</p>
<pre><code class="language-bash">composer dump-autoload</code></pre>
<p>Note: This command is run by default after <code>composer update</code>, <code>composer require ...</code> and similar commands. Since we'd manually changed our <code>autoload</code> section, we had to run it manually.</p>
<p>Now try our application and it should run.</p>
<p><strong>You are finished and all your classes are loaded by Composer.</strong> Congratulations!</p>
<h3 id="level-2-rename-directories-to-capital-case-to-respect-psr-4"><a class="anchor" href="#level-2-rename-directories-to-capital-case-to-respect-psr-4" aria-hidden="true"><span class="anchor-icon">#</span></a>Level 2: Rename Directories to capital case, to Respect PSR-4</h3>
<p>There is one more level I do with my applications, so my <code>composer.json</code> is nice and clear. But this is optional. Do it only if you'd like to write better code with lower WTF factor!</p>
<p>Turn this:</p>
<pre><code class="language-bash">/app
    /forms
    /model
    /presenters
    /routing
    /...</code></pre>
<p>Into this:</p>
<pre><code class="language-bash">/app
    /Forms
    /Model
    /Presenters
    /Routing
    /...</code></pre>
<p>After these steps, you can simplify your <code>autoload</code> section as such:</p>
<pre><code class="language-json">{
    "autoload": {
        "psr-4": {
            "App\\": "app"
        }
    }
}</code></pre>
<p>Don't forget to run:</p>
<pre><code class="language-bash">composer dump-autoload</code></pre>
<p>And you've unlocked Level 2.</p>
<p>That's it!</p>
                </div>
            </div>

            <br>

            <div class="intermezzo-smaller">
                <div class="container">

Deprecated: "{$post|similarPosts} Latte filter was deprecated and will be removed in Statie 3.0. Use {$post|relatedPosts} instead." in /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php on line 38

Call Stack:
    0.0001     362888   1. {main}() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie:0
    0.0003     371288   2. include_once('/home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie.php') /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie:4
    0.3133    7501304   3. Symfony\Component\Console\Application->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie.php:43
    0.3220    7677016   4. Symfony\Component\Console\Application->doRun() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:125
    0.3223    7677016   5. Symfony\Component\Console\Application->doRunCommand() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:224
    0.3223    7677016   6. Symplify\Statie\Console\Command\GenerateCommand->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:888
    0.3234    7681744   7. Symplify\Statie\Console\Command\GenerateCommand->execute() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Command/Command.php:262
    0.3235    7681744   8. Symplify\Statie\Application\StatieApplication->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Console/Command/GenerateCommand.php:43
    0.3710    9101952   9. Symplify\Statie\Application\StatieApplication->processTemplates() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Application/StatieApplication.php:63
    0.3714    9112680  10. Symplify\Statie\Renderable\RenderableFilesProcessor->processFiles() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Application/StatieApplication.php:105
    0.8253    9983752  11. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFiles() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/RenderableFilesProcessor.php:64
   62.1453   12842800  12. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFile() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:48
   62.1454   12840136  13. Symplify\Statie\Renderable\Latte\LatteFileDecorator->renderToString() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:79
   62.1454   12840232  14. Symplify\Statie\FlatWhite\Latte\LatteRenderer->renderExcludingHighlightBlocks() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:127
   62.1456   12861560  15. Latte\Engine->renderToString() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/FlatWhite/src/Latte/LatteRenderer.php:68
   62.1920   12799024  16. Template1c73ecc090->capture() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Engine.php:81
   62.1920   12816344  17. Template1c73ecc090->render() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:326
   62.1921   12822784  18. Templatefbb92eba61->render() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:176
   62.1922   12823264  19. Templatefbb92eba61->main() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:198
   62.1927   12834112  20. Templatefbb92eba61->renderBlock() /tmp/_flat_white_latte_factory_cache/fbb92eba61.php:89
   62.1928   12834112  21. Templatefbb92eba61->blockRelatedPosts() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:282
   62.1928   12834136  22. Symplify\Statie\RelatedPosts\Latte\Filter\RelatedPostsFilter->Symplify\Statie\RelatedPosts\Latte\Filter\{closure}() /tmp/_flat_white_latte_factory_cache/fbb92eba61.php:169
   62.1928   12834136  23. trigger_error() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php:38


                </div>
            </div>

            <div class="container">
<div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//' + "pehapkari" + '.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <br>
        </div>

        <script src="/assets/prism/prism.js"></script>
        <script id="dsq-count-scr" src="https://pehapkari.disqus.com/count.js" async defer></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', "UA-89860072-1", 'auto');
    ga('send','pageview');
</script>
<script async defer src="https://www.google-analytics.com/analytics.js"></script>
<script>
    !function(f,b,e,v,n,t,s){ if(f.fbq)return;n=f.fbq=function(){ n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
            document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', "201338863559186");
    fbq('track', 'PageView');
</script>
    </body>
</html>


    <meta property="og:type" content="article">
    <meta property="og:title" content="Drop RobotLoader and let Composer Deal with Autoloading">
    <meta property="og:description" content="Using 2 tools for one thing, in this case 2 packages to autoload classes, are sign of an architecture smell. Many applications I see contain RobotLoader for historical reasons. I will borrow this from psychology: pathological behavioral patterns tear us down in the present, but were useful in past.

The best way to deal with them is acknowledge their purpose and then, let them go and enjoy the gift of present.">
    <meta property="og:url" content="https://pehapkari.cz/blog/2017/03/02/drop-robot-loader-and-let-composer-deal-with-autoloading/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Drop RobotLoader and let Composer Deal with Autoloading">
    <meta name="twitter:description" content="Using 2 tools for one thing, in this case 2 packages to autoload classes, are sign of an architecture smell. Many applications I see contain RobotLoader for historical reasons. I will borrow this from psychology: pathological behavioral patterns tear us down in the present, but were useful in past.

The best way to deal with them is acknowledge their purpose and then, let them go and enjoy the gift of present.">


    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css">


