<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="description" content="Oficiální stránky PHP komunity">
    <meta name="keywords" content="PHP, komunita, programování">
    <meta name="author" content="https://pehapkari.cz">
    <meta name="robots" content="index, follow">

    <meta property="og:image" content="/images/php-square.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href="/assets/bootstrap/bootstrap.min.css?v=0.6" rel="stylesheet" type="text/css">

    <link href="/assets/css/style.css?v=0.6" rel="stylesheet" type="text/css">

    <link href="/favicon.ico" rel="shortcut icon">

    <title>How to use Comparison Constraints with Symfony/Validator</title>
</head>

    <body>
<header>
    <div class="hidden-sm-down">
        <div class="container-fluid">
            <a href="/"><img src="/assets/images/logo-header.svg?ver" alt="" height="50"></a>

            <nav class="navbar top-navigation">
                <a href="/blog/" class="active">
                    <em class="fa fa-newspaper-o fa-fw"></em>
                    Blog
                </a>
                <a href="/vzdelavej-se/">
                    <em class="fa fa-graduation-cap fa-fw"></em>
                    Školení
                </a>
                <a href="/mentori/">
                    <em class="fa fa-handshake-o fa-fw"></em>
                    Mentoři
                </a>

                    

                    <a href="https://github.com/pehapkari/pehapkari.cz/edit/master/source/_posts/2017/2017-02-11-symfony-validator-comparison-constraints.md" class="hidden-sm">
                        <em class="fa fa-fw fa-pencil"></em>
                        Edit
                    </a>
            </nav>
        </div>
    </div>

    <div id="mobile-menu" class="row text-center hidden-md-up">
        <div class="container">
            <a href="/" class="col-3 col-sm-3">
                <em class="fa fa-home"></em>
                <br>
                Home
            </a>
            <a href="/blog/" class="col-3 col-sm-3 active">
                <em class="fa fa-book fa-fw"></em>
                <br>
                Blog
            </a>
            <a href="/vzdelavej-se/" class="col-3 col-sm-3">
                <em class="fa fa-graduation-cap fa-fw"></em>
                <br>
                Školení
            </a>
            <a href="/mentori/" class="col-3 col-sm-3">
                <em class="fa fa-handshake-o fa-fw"></em>
                <br>
                Mentoři
            </a>
        </div>
    </div>
</header>

        <div id="article">
            <div class="container">
                <h1 class="h2 text-center">How to use Comparison Constraints with Symfony/Validator</h1>

                <div class="row text-center">
                    <div class="col-md-12">
<div class="metadataLine">
        
        <p class="success">
            <strong><em class="fa fa-fw fa-check-square-o"></em>
                <a href="https://github.com/pehapkari/pehapkari.cz/tree/master/tests/Posts/Year2017/SymfonyValidatorComparisonConstraints">
                    This post is Tested
                </a>
            </strong>
        </p>

    <p>
        <em class="fa fa-clock-o fa-fw"></em>
        2 min

        |

        by <strong>Jáchym Toušek</strong>

        &ndash;

        <time datetime="2017-02-Sat">
            11. 2. 2017
        </time>

    </p>
</div>
                    </div>
                </div>

                <br>

                <div id="article-content">
                    <p class="perex">With Symfony/Validator there is no obvious way to implement validations like comparing a value to another property on the same object. There are several articles about this topic already but literally all of them are completely outdated. In this article I'll cover the correct way to solve this.</p>

                    
<h3 id="example-use-case"><a class="anchor" href="#example-use-case" aria-hidden="true"><span class="anchor-icon">#</span></a>Example use case</h3>
<p>For date interval ensure that starting date is lower than ending date.</p>
<pre><code class="language-php">use Symfony\Component\Validator\Constraints as Assert;

class Event
{
    /**
     * @var \DateTime
     * @Assert\Type("DateTime")
     */
    protected $startDate;

    /**
     * @todo Add validator constraint that end date cannot be lower than start date.
     * @var \DateTime
     * @Assert\Type("DateTime")
     */
    protected $endDate;
}</code></pre>
<h3 id="the-outdated-solution"><a class="anchor" href="#the-outdated-solution" aria-hidden="true"><span class="anchor-icon">#</span></a>The outdated solution</h3>
<p>The obvious solution is to create a custom constraint and validator. It's explained in <a href="https://creativcoders.wordpress.com/2014/07/19/symfony2-two-fields-comparison-with-custom-validation-constraints/">several</a> <a href="http://www.yewchube.com/2011/08/symfony-2-field-comparison-validator/">articles</a> and <a href="http://stackoverflow.com/questions/15972404/symfony2-validation-datetime-1-should-be-before-datetime-2">StackOverflow</a> <a href="http://stackoverflow.com/questions/8170301/symfony2-form-validation-based-on-two-fields">questions</a>. Note that all of these are several years old. With the solution they recommend you might easily end up with a lot of custom constraints. Other answers suggest using the Callback constraint instead but that's still more complicated than necessary.</p>
<h3 id="the-correct-solution"><a class="anchor" href="#the-correct-solution" aria-hidden="true"><span class="anchor-icon">#</span></a>The correct solution</h3>
<p>The point of this article is that Symfony actually does have an <a href="http://symfony.com/doc/current/reference/constraints/Expression.html">easy mechanism</a> to do these validations. <strong>The Expression constraint</strong> is not something new either. It's just not covered in the documentation very well and less experienced developers can easily miss it.</p>
<p>The Expression constraint takes advantage of the <a href="http://symfony.com/doc/current/components/expression_language.html">ExpressionLanguage</a> component. <strong>In the expression you can use the <code>value</code> and <code>this</code> placeholders</strong> to access the value itself and the underlying object respectively.</p>
<h3 id="example"><a class="anchor" href="#example" aria-hidden="true"><span class="anchor-icon">#</span></a>Example</h3>
<pre><code class="language-php">use Symfony\Component\Validator\Constraints as Assert;

class Event
{
    /**
     * @var \DateTime
     * @Assert\Type("DateTime")
     */
    protected $startDate;

    /**
     * @var \DateTime
     * @Assert\Type("DateTime")
     * @Assert\Expression("value &gt;= this.startDate")
     */
    protected $endDate;
}</code></pre>
<p>Indeed it's this easy! More importantly the Expression constraint can help you solve many other situations. <strong>Plus the ExpressionLanguage can be <a href="http://symfony.com/doc/current/components/expression_language/extending.html">extended</a> with your own functions.</strong></p>
<h3 id="usage-with-nette-framework"><a class="anchor" href="#usage-with-nette-framework" aria-hidden="true"><span class="anchor-icon">#</span></a>Usage with Nette Framework</h3>
<p>If you want to use the Symfony/Validator component and the Expression constraint in your Nette application you will need these libraries:</p>
<ul>
<li><a href="https://github.com/Kdyby/Validator">Kdyby/Validator</a></li>
<li><a href="https://github.com/Arachne/ExpressionLanguage">Arachne/ExpressionLanguage</a></li>
<li><a href="https://github.com/Arachne/Doctrine">Arachne/Doctrine</a> (optional, enables caching for the ExpressionLanguage parser)</li>
</ul>
                </div>
            </div>

            <br>

            <div class="intermezzo-smaller">
                <div class="container">

Deprecated: "{$post|similarPosts} Latte filter was deprecated and will be removed in Statie 3.0. Use {$post|relatedPosts} instead." in /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php on line 38

Call Stack:
    0.0001     362888   1. {main}() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie:0
    0.0003     371288   2. include_once('/home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie.php') /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie:4
    0.3133    7501304   3. Symfony\Component\Console\Application->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/bin/statie.php:43
    0.3220    7677016   4. Symfony\Component\Console\Application->doRun() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:125
    0.3223    7677016   5. Symfony\Component\Console\Application->doRunCommand() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:224
    0.3223    7677016   6. Symplify\Statie\Console\Command\GenerateCommand->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Application.php:888
    0.3234    7681744   7. Symplify\Statie\Console\Command\GenerateCommand->execute() /home/travis/build/pehapkari/pehapkari.cz/vendor/symfony/console/Command/Command.php:262
    0.3235    7681744   8. Symplify\Statie\Application\StatieApplication->run() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Console/Command/GenerateCommand.php:43
    0.3710    9101952   9. Symplify\Statie\Application\StatieApplication->processTemplates() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Application/StatieApplication.php:63
    0.3714    9112680  10. Symplify\Statie\Renderable\RenderableFilesProcessor->processFiles() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Application/StatieApplication.php:105
    0.8253    9983752  11. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFiles() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/RenderableFilesProcessor.php:64
   74.2763   12865520  12. Symplify\Statie\Renderable\Latte\LatteFileDecorator->decorateFile() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:48
   74.2764   12864120  13. Symplify\Statie\Renderable\Latte\LatteFileDecorator->renderToString() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:79
   74.2764   12864200  14. Symplify\Statie\FlatWhite\Latte\LatteRenderer->renderExcludingHighlightBlocks() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/src/Renderable/Latte/LatteFileDecorator.php:127
   74.2765   12873936  15. Latte\Engine->renderToString() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/FlatWhite/src/Latte/LatteRenderer.php:68
   74.3024   12895888  16. Template15e61b75b3->capture() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Engine.php:81
   74.3024   12913208  17. Template15e61b75b3->render() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:326
   74.3025   12922208  18. Templatefbb92eba61->render() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:176
   74.3026   12922688  19. Templatefbb92eba61->main() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:198
   74.3033   12936096  20. Templatefbb92eba61->renderBlock() /tmp/_flat_white_latte_factory_cache/fbb92eba61.php:89
   74.3033   12936096  21. Templatefbb92eba61->blockRelatedPosts() /home/travis/build/pehapkari/pehapkari.cz/vendor/latte/latte/src/Latte/Runtime/Template.php:282
   74.3033   12936120  22. Symplify\Statie\RelatedPosts\Latte\Filter\RelatedPostsFilter->Symplify\Statie\RelatedPosts\Latte\Filter\{closure}() /tmp/_flat_white_latte_factory_cache/fbb92eba61.php:169
   74.3033   12936120  23. trigger_error() /home/travis/build/pehapkari/pehapkari.cz/vendor/symplify/statie/packages/RelatedPosts/src/Latte/Filter/RelatedPostsFilter.php:38


        <h2>You Might Also Like</h2>

        <ul id="related-posts">
                <li>
                    <a href="/blog/2017/02/24/symfony-validator-dynamic-constraints">How to use Dynamic Constraints with Symfony/Validator &raquo;</a>
                </li>
                <li>
                    <a href="/blog/2017/02/18/symfony-validator-conditional-constraints">How to use Conditional Constraints with Symfony/Validator &raquo;</a>
                </li>
        </ul>
                </div>
            </div>

            <div class="container">
<div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//' + "pehapkari" + '.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
            </div>

            <br>
        </div>

        <script src="/assets/prism/prism.js"></script>
        <script id="dsq-count-scr" src="https://pehapkari.disqus.com/count.js" async defer></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', "UA-89860072-1", 'auto');
    ga('send','pageview');
</script>
<script async defer src="https://www.google-analytics.com/analytics.js"></script>
<script>
    !function(f,b,e,v,n,t,s){ if(f.fbq)return;n=f.fbq=function(){ n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
            document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', "201338863559186");
    fbq('track', 'PageView');
</script>
    </body>
</html>


    <meta property="og:type" content="article">
    <meta property="og:title" content="How to use Comparison Constraints with Symfony/Validator">
    <meta property="og:description" content="With Symfony/Validator there is no obvious way to implement validations like comparing a value to another property on the same object. There are several articles about this topic already but literally all of them are completely outdated. In this article I&#039;ll cover the correct way to solve this.">
    <meta property="og:url" content="https://pehapkari.cz/blog/2017/02/11/symfony-validator-comparison-constraints/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="How to use Comparison Constraints with Symfony/Validator">
    <meta name="twitter:description" content="With Symfony/Validator there is no obvious way to implement validations like comparing a value to another property on the same object. There are several articles about this topic already but literally all of them are completely outdated. In this article I&#039;ll cover the correct way to solve this.">


    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css">


